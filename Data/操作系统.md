## 操作系统（本科课程笔记）
[toc]
书1：现代操作系统，答案 http://www.docin.com/p-1064801733.html?docfrom=rrela
### chpt1 引论
工作原理和实现方法
技术含量最高的系统软件

![001](操作系统/001.jpg)

将硬件的复杂性与程序员分离开
定义：系统软件， 程序模块的集合，资源管理和用户接口功能
作用：
1. 作为扩展机器
* 裸机添加
* 理解“抽象”，如文件
2. 作为资源管理者／作业管理（大型机）
* 多路复用，时间与空间
3. 软硬件接口
* system call

#### 1.发展史

1. 批处理操作系统

	改进主存和I/O设备之间的吞吐量
	特征：用户脱机使用，无法交互

2. 多道程序设计 multiprogramming
	需要硬件保护
	宏观上并行，微观上串行
3. 系列机思想与IBM System/360系统
	统一的体系结构、指令集 -> 软件危机
4. 分时系统：轮流使用time slice
	unix操作系统：多用户、多任务、分时
	unic前身是MULTICS系统，内外环设计
5. 大规模集成电路时代
	分布式、嵌入式

#### 2.操作系统的硬件环境

**寄存器分类：**
- 用户可见寄存器: 高级语言编译器通过算法分配并使用之，以减少程序访问主存次数
  数据寄存器、地址寄存器、条件码寄存器（溢出、符号）

- 控制和状态寄存器: 用于控制处理器的操作，由OS的特权代码使用, 以控制其他程序的执行
  PC、IR、PSW(program status word)
  PSW中有一位CPU的状态工作码, PSW在系统调用和I/O中很重要

**核心态=管态、用户态=目态**

I/O不在用户态内
用户态->核心态: trap	核心态->用户态：修改PSW
e.g. x86: R0 R1 R2 R3

**层次化存储体系结构** ～ 容量、速度、成本

存储访问局部性原理
cpu访问寄存器不存在延时，操作系统不访问cache
磁带光盘价格极其低廉，作为磁盘的备份

shell 、GUI
多线程和多核芯片 书1p13

I/O：控制器+设备本身    device driver
![002](操作系统/002.jpg)
* 实现I/O的三种方式
轮询、中断、DMA芯片（总线竞争、大量I/O数据传送）

中断系统的两大组成部分: 硬件中断装置和软件中断处理程序 (中断设备的设备驱动程序的一部分)![005](操作系统/005.jpg)

启动计算机：主板BIOS
进程、地址空间、进程间通信
虚拟内存
UNIX：特殊文件、管道
rwx r-x --x     p25

**“个体重复系统发育”**，很深刻

#### 3.系统调用

1.6 系统调用~执行“trap”			功能号和参数
大多采用在内存中开辟专用堆栈区来传递参数

**linux系统调用**： 
system_call() 	sys_call_table

> Linux系统调用利用了x86体系结构中的软件中断，即调用了int $0x80汇编指令。这条汇编指令将产生向量为128的软件中断， CPU被切换到内核态，并将控制权交给系统调用过程的起点system_call()处理函数

系统调用与内核函数（即服务例程，e.g. sys_getpid()）
封装例程     ppt2-p56

![006](操作系统/006.jpg)

用于进程管理、文件管理、目录管理 书1p32
    UID、GID、PID
    PID～fork，waitpid指令
        fork不可继承的有:进程标识符，父进程标识符
[execve](https://my.oschina.net/u/3857782/blog/1854572)：替换一个进程的核心映像

**POSIX过程调用** ：进程管理(fork, execve, waitpid, exit(status) )、文件管理(open, ...)、目录管理（mkdir, rmdir, ..., umount, unlink）、其它([chmod](https://blog.csdn.net/pythonw/article/details/80263428), kill, chdir, time)
<-> 

WIN32 API: 

![003](操作系统/003.jpg)
#### 4.操作系统结构
* 单体系统（模块组合结构）
* 层次式系统
分层：全序、偏序、半序
* 微内核
* 虚拟机结构: VM/370
会话监控系统CMS
![004](操作系统/004.jpg)
这是1型超级监控程序（cons：用户态不能陷入）
2型：VMWare，主机/客户操作系统
* 微内核结构：运行在核心态的内核􏰁供最基本的操作系统功 能，包括中断处理、处理机调度、进程间通信。这些部 分只􏰁供了一个很小的功能集合，通常称为微内核
特点：Mechanism和policy分离=>使内核更小
微内核结构的变体：客户-服务器模型
客户进程与服务器进程之间使用消息进行通信

![Windows内核结构](操作系统/004.jpg)







